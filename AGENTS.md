# OpenClaw Project Guide

This file serves as context for AI agents working on the OpenClaw project. Read this when starting any session.

## Project Overview

**OpenClaw** is a self-hosted, autonomous AI agent platform that runs 24/7 on a VPS. It's designed to be:
- **Always-on**: Runs continuously with periodic heartbeats
- **Multi-channel**: Telegram, WhatsApp, Discord, CLI, REST API
- **Skill-based**: Extensible through dynamically installable skills
- **Privacy-focused**: Self-hosted, encrypted, no cloud dependencies (beyond Claude API)
- **Docker-based**: Portable, isolated environment

## Repository Structure

This repo (`clawformation`) contains deployment config — **not the OpenClaw source code**. On the server, it lives at `/root/clawformation/` alongside the OpenClaw software at `/root/openclaw/`.

```
clawformation/                           # Deployment config (this repo)
├── setup.sh                         # Main installer script
├── Dockerfile.skills                # Extended Docker image (Go, Homebrew, browser)
├── docker-compose.yml               # Docker Compose services
├── openclaw.json.template           # Config template (Telegram + WhatsApp)
├── sync.sh                          # Pull server config backup to .openclaw/
├── AGENTS.md                        # This file — project context for AI agents
├── README.md                        # Setup and usage docs
├── vps-setup-guide.md               # Detailed beginner guide
├── skills-management.md             # Skills system reference
├── telegram-setup.md                # Telegram channel guide
├── tailscale-setup.md               # Tailscale VPN setup
├── secure-vps.sh                    # VPS hardening script
└── .gitignore

Not committed (gitignored):
├── .openclaw/                       # Server config backup (via sync.sh)
│   ├── openclaw.json                # Live config (contains secrets)
│   ├── workspace/                   # Agent memory and state
│   ├── agents/                      # Agent runtime data
│   ├── credentials/                 # Auth storage
│   └── ...
└── openclaw.json                    # Local config copy (if any)
```

**On the server:**
```
/root/clawformation/                     # This repo (cloned via deploy key)
/root/openclaw/                      # OpenClaw source (cloned from GitHub)
├── Dockerfile                       # Base image (upstream)
├── Dockerfile.skills                # Extended image (copied from clawformation)
├── docker-compose.yml               # Services (copied from clawformation)
└── .env                             # Secrets (generated by installer)
/root/.openclaw/                     # Persistent config
├── openclaw.json                    # Live config
└── workspace/                       # Agent state & memory
```

## Key Files

### `setup.sh`
The main installer. Safe to re-run — preserves existing `.env` and `openclaw.json`.
1. Updates Ubuntu and installs Docker
2. Clones OpenClaw source repo
3. Generates secure tokens (`.env`)
4. Copies `docker-compose.yml` and `Dockerfile.skills` from this repo
5. On first run: prompts for channel setup (Telegram/WhatsApp/both)
6. Creates `openclaw.json` from template with user's values
7. Builds base image, then extended image (Go, Homebrew, Chromium, Playwright)
8. Starts gateway service

### `Dockerfile.skills`
Extends the upstream OpenClaw base image with:
- Go 1.24.0 (for Go-based skills)
- Homebrew (for system packages)
- Chromium + Playwright (browser automation)
- npm global prefix config
- `openclaw` CLI symlink

### `docker-compose.yml`
Defines two services. Uses `${VAR}` syntax resolved from `.env`:
- **openclaw-gateway** — REST API on port 18789 (localhost only)
- **openclaw-cli** — Command-line interface (on-demand)

### `openclaw.json.template`
Template for the live config. Key sections:
- `agents.defaults` — Model, model allowlist, heartbeat interval, concurrency
- `channels.telegram` — Bot token, user allowlist, stream mode
- `channels.whatsapp` — Phone number allowlist, DM/group policies
- `plugins.entries` — Which channels are enabled/disabled

### `sync.sh`
Pulls server config to local `.openclaw/` directory for backup:
```bash
./sync.sh          # uses "openclaw" SSH alias
./sync.sh my-host  # custom hostname
```

## Development Preferences

### Code Style
- **Bash scripts**: Use `set -euo pipefail`, colored output, clear step logging
- **Docker**: Multi-stage builds, non-root user (node:1000), minimal layers
- **Config**: JSON with comments explaining each section
- **Documentation**: Markdown, clear structure, code examples

### Git & PRs
- **No Co-Authored-By lines** or any Claude/AI advertising in commits or PRs
- Commit messages should be concise and describe the change, nothing more

### Conventions
- **Secrets**: Generate with `openssl rand -hex 32`, never hardcode
- **Paths**:
  - Config: `/root/.openclaw` (VPS) or `.openclaw/` (local backup)
  - Workspace: `$OPENCLAW_CONFIG/workspace`
  - Docker home: `/home/node`
- **Ports**: Gateway on 18789, bind to `127.0.0.1` (SSH tunnel for access)
- **User**: Everything runs as `node` user (UID 1000) in Docker
- **Models**: Use short names without date suffixes (`anthropic/claude-haiku-4-5`, not `anthropic/claude-haiku-4-5-20251001`)

### Tools & Stack
- **Runtime**: Node.js (base image), Docker Compose
- **Languages**: TypeScript (OpenClaw core), Bash (deployment), Go/Python (skills)
- **Package managers**: npm (preferred), Homebrew (system tools), Go modules
- **Browser**: Chromium + Playwright (headless automation)
- **Messaging**: Telegram (primary), WhatsApp (optional)

## Browser Automation

**Capabilities:**
- Full web automation via Playwright
- Headless Chromium browser
- 28-parameter `browser` tool available to agents
- Screenshot capture, form filling, scraping, etc.

**Configuration:**
- Browser: `/usr/bin/chromium`
- Driver: `chromium-driver`
- Playwright: Installed globally via npm
- Environment variables set for both Puppeteer and Playwright
- Runs in Docker as `node` user

## Agent Behavior

### Agent Identity
The deployed agent's personality and behavior are configured through workspace files:
- `workspace/SOUL.md` — Core identity and behavioral guidelines
- `workspace/IDENTITY.md` — Agent name and personality traits
- `workspace/USER.md` — Owner's profile and preferences

These files are created during onboarding or can be customized manually.

### Security Principles
- Never exfiltrate private data
- Ask before destructive commands
- Use `trash` over `rm`
- Don't skip git hooks
- Don't force-push to main
- Validate user input at boundaries only

## Common Tasks

### Deploying Changes
1. Edit files locally in clawformation
2. Commit and push: `git push`
3. Pull on server: `ssh root@YOUR_VPS 'cd /root/clawformation && git pull'`
4. If Dockerfile.skills or docker-compose.yml changed:
   ```bash
   cp /root/clawformation/Dockerfile.skills /root/openclaw/
   cp /root/clawformation/docker-compose.yml /root/openclaw/
   cd /root/openclaw && docker build -t openclaw:latest -f Dockerfile.skills . && docker compose up -d
   ```
5. Or re-run the full installer: `bash /root/clawformation/setup.sh`

### Updating Configuration
1. Edit `/root/.openclaw/openclaw.json` on VPS
2. Restart gateway: `cd /root/openclaw && docker compose restart openclaw-gateway`
3. No rebuild needed for config changes

### Backing Up Server Config
```bash
./sync.sh   # pulls /root/.openclaw/ → .openclaw/
```

### Adding Skills
- Agent can self-install skills dynamically
- Skills install to `/home/node/.openclaw/skills/`
- Use npm/go/brew as needed (all available in container)
- Bundled skills: `healthcheck`, `skill-creator`, `weather`

### Debugging
- Logs: `docker compose logs -f openclaw-gateway`
- Health check: `curl http://127.0.0.1:18789/health`
- Sessions: Check `agents/main/sessions/sessions.json`
- Memory: Check `workspace/memory/YYYY-MM-DD.md`

## Deployment Workflow

**Fresh Ubuntu VPS:**
```bash
git clone https://github.com/lylo/clawformation.git /root/clawformation
bash /root/clawformation/setup.sh
```

**Update deployment config:**
```bash
cd /root/clawformation && git pull
bash /root/clawformation/setup.sh
```

**Update OpenClaw software:**
```bash
cd /root/openclaw && git pull
docker compose build && docker compose up -d
```

**Access Control UI (dashboard):**
```bash
ssh -N -L 18789:127.0.0.1:18789 root@YOUR_VPS_IP
# Then open http://localhost:18789 and enter gateway token
```

## Testing

**Telegram:**
Send a message to your bot in Telegram.

**Browser tool:**
```
"Take a screenshot of https://example.com"
```

**Heartbeat:**
Wait 30 minutes or trigger manually via gateway API.

## Resources

- **OpenClaw repo**: https://github.com/openclaw/openclaw
- **Docs**: `vps-setup-guide.md` for deployment details
- **API**: Gateway REST API on port 18789

## Notes for Future Sessions

- **Always read this file first** when working on OpenClaw
- The setup script and companion files (Dockerfile.skills, docker-compose.yml, openclaw.json.template) are the source of truth for deployment
- Agent workspace is precious — don't mess with memory files
- Gateway token is in `.env` — keep it secret
- Use short model names without date suffixes

## Philosophy

OpenClaw is about **autonomy with oversight**. The agent should:
- Be proactive but not intrusive
- Learn and adapt through skills
- Maintain continuity through memory
- Respect privacy and security
- Work 24/7 but know when to stay quiet

Build features that support this vision.
